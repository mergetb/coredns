FROM fedora:28

RUN dnf update -y

RUN dnf install -y \
  openssl \
  https://mirror.deterlab.net/merge/kea-1.4.0_P1-1.fc28.x86_64.rpm \
  https://mirror.deterlab.net/merge/kea-libs-1.4.0_P1-1.fc28.x86_64.rpm \
  https://mirror.deterlab.net/merge/kea-devel-1.4.0_P1-1.fc28.x86_64.rpm \
  https://mirror.deterlab.net/merge/grpc-devel-2.0.0-1.fc28.x86_64.rpm \
  https://mirror.deterlab.net/merge/etcd_cpp_apiv3-0.1.1-Linux.rpm \
  cpprest-devel protobuf-devel protobuf-c-devel \
  golang godep
RUN dnf groupinstall -y "C Development Tools and Libraries"
RUN dnf groupinstall -y "RPM Development Tools"


WORKDIR /root/rpmbuild/SOURCES
COPY . ./nex

# build rpm
WORKDIR /root/rpmbuild/SPECS
RUN cp /root/rpmbuild/SOURCES/nex/rpm/nex.spec .
RUN rpmbuild -vv -ba nex.spec

WORKDIR /root/rpmbuild/SOURCES/nex/
CMD ["./copy-artifacts.sh"]
