FROM fedora:28

ADD ./merge.repo /etc/yum.repos.d/merge.repo
RUN rpm --import https://build.mergetb.net/rpm/MergeTB-GPG-Public

RUN dnf update --refresh -y

RUN dnf install -y golang dep make
RUN dnf groupinstall -y "RPM Development Tools"

WORKDIR /root/rpmbuild/SOURCES
COPY . ./nex

# build rpm
WORKDIR /root/rpmbuild/SPECS
RUN cp /root/rpmbuild/SOURCES/nex/rpm/nex-dhcp-dns.spec .
RUN rpmbuild -vv -ba nex-dhcp-dns.spec

WORKDIR /root/rpmbuild/SOURCES/nex/
CMD ["./copy-artifacts.sh"]
