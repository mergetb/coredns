FROM fedora:28

ADD ./merge.repo /etc/yum.repos.d/merge.repo
RUN rpm --import https://build.mergetb.net/rpm/MergeTB-GPG-Public

RUN dnf update --refresh -y

RUN dnf install -y \
  openssl \
  kea-1.4.0_P1 \
  kea-libs-1.4.0_P1 \
  kea-devel-1.4.0_P1 \
  protobuf-3.6.1 \
  grpc-devel-2.0.0 \
  etcd_cpp_apiv3 \
  cpprest-devel \
  golang godep
RUN dnf groupinstall -y "C Development Tools and Libraries"
RUN dnf groupinstall -y "RPM Development Tools"


WORKDIR /root/rpmbuild/SOURCES
COPY . ./nex

# build rpm
WORKDIR /root/rpmbuild/SPECS
RUN cp /root/rpmbuild/SOURCES/nex/rpm/nex-dhcp-dns.spec .
RUN rpmbuild -vv -ba nex-dhcp-dns.spec

WORKDIR /root/rpmbuild/SOURCES/nex/
CMD ["./copy-artifacts.sh"]
