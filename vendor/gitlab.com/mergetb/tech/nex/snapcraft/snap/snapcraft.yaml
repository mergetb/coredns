name: mergetb-nex
version: '0.1' 
summary: An integrated, resilient and scalable DHCP/DNS system
description: |
  Nex is the spirit of dnsmasq meets modern scale out architecture. The design
  is inspired and motivated by the recent success Facebook has had with 
  deploying Kea using a stateless replicated model. Nex is based on a similar 
  stateless service model, built on a simple Go based DHCP server and CoreDNS, 
  with an etcd deployment that brings them together into a cohesive system - 
  ala dnsmasq.

grade: devel 
confinement: devmode 

parts:
  dhcp:
    plugin: dump
    source: .
    organize:
      build/nexc: bin/nexc
      build/nexd: bin/nexd
      build/loader: bin/loader
      build/nex-dhcpd: bin/nex-dhcpd
      build/coredns: bin/coredns
      nex-default.yml: config/nex.yml

apps:
  dhcpd:
    daemon: simple
    command: bin/nex-dhcpd
    plugs: [network, network-bind]

  coredns:
    daemon: simple
    command: bin/coredns
    plugs: [network, network-bind]

  nexd:
    daemon: simple
    command: bin/nexd
    plugs: [network, network-bind]

  nexc:
    command: bin/nexc
    plugs: [network]

  loader:
    command: bin/loader
    plugs: [network]

passthrough:
  layout:
    /etc/merge:
      bind: $SNAP_DATA/etc/merge
